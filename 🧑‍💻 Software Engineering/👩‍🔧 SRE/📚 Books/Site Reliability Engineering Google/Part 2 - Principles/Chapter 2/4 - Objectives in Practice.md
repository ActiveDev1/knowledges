**اهداف در عمل**

برای تعریف **SLO** (Service Level Objectives)، ابتدا باید به آنچه **کاربران** به آن اهمیت می‌دهند فکر کنید یا آن را کشف کنید، نه فقط به آنچه می‌توانید اندازه‌گیری کنید. اغلب، نیازهای کاربران به‌سختی یا به‌طور کامل قابل اندازه‌گیری نیستند، بنابراین باید به‌نحوی آن‌ها را **تقریب** بزنید. اما اگر صرفاً با معیارهای آسان شروع کنید، **SLO**های کمتر مفیدی خواهید داشت. تجربه نشان داده که کار از **اهداف موردنظر** به عقب و رسیدن به **شاخص‌های خاص** (SLI) بهتر از انتخاب ابتدا SLI و سپس تعیین اهداف است.

### تعریف اهداف
برای حداکثر وضوح، **SLO**ها باید مشخص کنند که چگونه اندازه‌گیری می‌شوند و در چه شرایطی معتبر هستند. 
- **مثال**:
  - «99% (میانگین در 1 دقیقه) از فراخوانی‌های Get RPC در کمتر از 100 میلی‌ثانیه تکمیل می‌شوند (اندازه‌گیری‌شده در تمام سرورهای backend).»
  - یا به‌صورت خلاصه (با استفاده از پیش‌فرض‌های SLI): «99% از فراخوانی‌های Get RPC در کمتر از 100 میلی‌ثانیه تکمیل می‌شوند.»
- اگر شکل **منحنی‌های عملکرد** مهم باشد، می‌توان چندین هدف SLO تعیین کرد:
  - 90% از فراخوانی‌های Get RPC در کمتر از 1 میلی‌ثانیه.
  - 99% از فراخوانی‌های Get RPC در کمتر از 10 میلی‌ثانیه.
  - 99.9% از فراخوانی‌های Get RPC در کمتر از 100 میلی‌ثانیه.
- برای کاربران با **کارهای متنوع** (مثل pipeline پردازش دسته‌ای که به **throughput** اهمیت می‌دهد و کلاینت تعاملی که به **latency** حساس است)، می‌توان SLOهای جداگانه تعریف کرد:
  - 95% از فراخوانی‌های Set RPC کلاینت‌های **throughput** در کمتر از 1 ثانیه.
  - 99% از فراخوانی‌های Set RPC کلاینت‌های **latency** با payload کمتر از 1 کیلوبایت در کمتر از 10 میلی‌ثانیه.

انتظار اینکه SLOها 100% اوقات رعایت شوند، غیرواقعی و نامطلوب است، زیرا می‌تواند:
- سرعت **نوآوری** و **دیپلوی** را کاهش دهد.
- به راه‌حل‌های گران‌قیمت و بیش‌ازحد محافظه‌کارانه منجر شود.
به‌جای آن، بهتر است یک **error budget** (نرخ مجاز نقض SLO) تعریف کرده و آن را روزانه یا هفتگی رصد کنید. مدیران ارشد ممکن است ارزیابی ماهانه یا فصلی بخواهند. (**Error budget** خود یک SLO برای رعایت سایر SLOهاست!)

نرخ نقض SLO می‌تواند با **error budget** مقایسه شود (رجوع به *Motivation for Error Budgets*)، و اختلاف آن به‌عنوان ورودی برای تصمیم‌گیری درباره **rollout** releaseهای جدید استفاده شود.

### انتخاب اهداف
انتخاب **SLO**ها صرفاً یک فعالیت فنی نیست، زیرا به **پیامدهای محصول و کسب‌وکار** مرتبط است. این پیامدها باید در **SLI**ها، **SLO**ها و شاید **SLA**ها منعکس شوند. همچنین، ممکن است لازم باشد بین ویژگی‌های محصول (مثل سرعت در برابر هزینه) با توجه به محدودیت‌های **نیروی انسانی**، **زمان عرضه به بازار**، **دسترسی به سخت‌افزار**، و **بودجه** تعادل برقرار شود. SRE باید در این گفتگوها شرکت کند و درباره **ریسک‌ها** و **امکان‌پذیری** گزینه‌ها مشاوره دهد. درس‌هایی که آموخته‌ایم:
- **عملکرد فعلی را مبنا قرار ندهید**: درک محدودیت‌ها و قابلیت‌های سیستم ضروری است، اما انتخاب اهداف بدون تأمل ممکن است شما را به پشتیبانی از سیستمی با تلاش‌های **heroic** برای رسیدن به اهدافش وادار کند که بدون بازطراحی قابل‌بهبود نیست.
- **ساده نگه دارید**: تجمیع‌های پیچیده در SLIها می‌تواند تغییرات عملکرد سیستم را پنهان کند و استدلال درباره آن‌ها را دشوار سازد.
- **از مطلق‌ها اجتناب کنید**: درخواست سیستمی که بار را "بی‌نهایت" مقیاس‌پذیر کند یا "همیشه" در دسترس باشد، غیرواقعی است. چنین سیستمی طراحی و اجرای گران‌قیمتی دارد و احتمالاً بیش‌ازحد بهتر از نیاز کاربران است.
- **حداقل SLO داشته باشید**: فقط تعداد کافی SLO انتخاب کنید تا ویژگی‌های سیستم را پوشش دهد. از SLOهایی که نمی‌توانید در بحث اولویت‌ها از آن‌ها دفاع کنید، اجتناب کنید. برخی ویژگی‌های محصول (مثل "لذت کاربر") برای تعریف به‌عنوان SLO مناسب نیستند.
- **کمال‌طلبی می‌تواند منتظر بماند**: می‌توانید تعریف و اهداف SLO را با یادگیری رفتار سیستم بهبود دهید. شروع با هدف آزاد و سپس سفت‌تر کردن آن بهتر از انتخاب هدف بیش‌ازحد سخت و سپس شل کردن آن است.

**SLO**ها باید عامل اصلی در **اولویت‌بندی کار** برای SREها و توسعه‌دهندگان محصول باشند، زیرا نیازهای کاربران را منعکس می‌کنند. یک SLO خوب یک نیروی مشروع و مفید برای تیم توسعه است. اما SLO نادرست می‌تواند به **کار هدررفته** (برای رسیدن به هدف بیش‌ازحد سخت) یا **محصول بد** (به دلیل هدف بیش‌ازحد شل) منجر شود. SLOها اهرم قدرتمندی هستند: با دقت از آن‌ها استفاده کنید.

### اقدامات کنترلی
**SLI**ها و **SLO**ها عناصر کلیدی در **حلقه‌های کنترلی** مدیریت سیستم‌ها هستند:
1. **مانیتور و اندازه‌گیری** SLIهای سیستم.
2. **مقایسه SLIها با SLOها** و تصمیم‌گیری درباره نیاز به اقدام.
3. اگر اقدام لازم است، مشخص کنید چه چیزی برای رسیدن به هدف باید انجام شود.
4. آن اقدام را انجام دهید.
- **مثال**: اگر مرحله 2 نشان دهد **latency** درخواست‌ها در حال افزایش است و چند ساعت دیگر SLO نقض می‌شود، مرحله 3 ممکن است شامل تست فرضیه **CPU-bound** بودن سرورها و افزودن سرورهای بیشتر برای توزیع بار باشد. بدون SLO، نمی‌دانستید چه زمانی یا آیا باید اقدامی کنید.

### SLOها انتظارات را تنظیم می‌کنند
انتشار **SLO**ها انتظارات درباره رفتار سیستم را مشخص می‌کند. کاربران (و کاربران بالقوه) می‌خواهند بدانند چه انتظاری از سرویس داشته باشند تا بفهمند آیا برای **use case** آن‌ها مناسب است. 
- **مثال**: تیمی که وب‌سایت اشتراک‌گذاری عکس می‌سازد، ممکن است از سرویسی با **durability** بالا و هزینه کم اما **availability** کمی پایین‌تر اجتناب کند، اما همان سرویس برای سیستم مدیریت آرشیو مناسب است.

برای تنظیم انتظارات واقع‌بینانه، می‌توانید از این تاکتیک‌ها استفاده کنید:
- **حاشیه ایمنی نگه دارید**: استفاده از SLO داخلی سخت‌گیرانه‌تر از SLO اعلام‌شده به کاربران، به شما زمان پاسخ به مشکلات مزمن را قبل از تأثیر خارجی می‌دهد. این **بافر** امکان تغییر پیاده‌سازی (مثل کاهش عملکرد برای هزینه کمتر یا نگهداری آسان‌تر) را بدون ناامید کردن کاربران فراهم می‌کند.
- **بیش‌ازحد خوب نباشید**: کاربران به عملکرد واقعی سرویس وابسته می‌شوند، نه آنچه در SLO گفته‌اید، به‌ویژه در سرویس‌های زیرساختی. اگر عملکرد واقعی خیلی بهتر از SLO باشد، کاربران به آن وابسته می‌شوند. برای جلوگیری از **over-dependence**، می‌توانید سیستم را گاهی عمداً **offline** کنید (مثل قطعی‌های برنامه‌ریزی‌شده **Chubby**)، برخی درخواست‌ها را **throttle** کنید، یا سیستم را طوری طراحی کنید که در بار کم بیش‌ازحد سریع نباشد.

درک اینکه سیستم تا چه حد انتظارات را برآورده می‌کند، به تصمیم‌گیری درباره سرمایه‌گذاری در **سرعت**، **availability**، یا **resilience** کمک می‌کند. اگر سرویس وضعیت خوبی دارد، شاید بهتر باشد زمان تیم صرف اولویت‌های دیگر مثل **پرداخت بدهی فنی**، افزودن ویژگی‌های جدید، یا معرفی محصولات دیگر شود.