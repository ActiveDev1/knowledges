**شناسایی تحمل ریسک سرویس‌های زیرساختی**

نیازهای ساخت و اجرای سرویس‌های **infrastructure** با سرویس‌های **consumer** متفاوت است. تفاوت اصلی این است که سرویس‌های زیرساختی، به‌طور ذاتی، چندین **client** با نیازهای متنوع دارند.

### سطح هدف Availability
به عنوان مثال، **Bigtable** یک سیستم ذخیره‌سازی توزیع‌شده در مقیاس بزرگ برای داده‌های ساختاریافته است. برخی سرویس‌های **consumer** مستقیماً از Bigtable برای پاسخ به درخواست‌های کاربران استفاده می‌کنند و به **low latency** و **high reliability** نیاز دارند. در مقابل، تیم‌هایی که از Bigtable برای **offline analysis** (مثل MapReduce) استفاده می‌کنند، بیشتر به **throughput** اهمیت می‌دهند تا **reliability**. تحمل ریسک این دو گروه کاملاً متفاوت است.

مهندسی همه سرویس‌های زیرساختی برای **ultra-reliability** ممکن است، اما به دلیل تجمیع منابع عظیم، معمولاً بسیار گران است. برای درک نیازهای کاربران مختلف، می‌توان به وضعیت **request queue** برای هر نوع کاربر Bigtable نگاه کرد.

### انواع Failureها
- کاربران **low-latency** می‌خواهند **request queue**های Bigtable تقریباً همیشه خالی باشند تا درخواست‌ها فوراً پردازش شوند (زیرا queuing ناکارآمد باعث **high tail latency** می‌شود).
- کاربران **offline analysis** به **throughput** اهمیت می‌دهند و می‌خواهند **request queue**ها هرگز خالی نباشند تا سیستم بی‌کار نماند.
موفقیت برای یک گروه (مثلاً خالی بودن queue برای low-latency) به معنای شکست برای گروه دیگر (مثلاً کاهش throughput) است.

### هزینه (Cost)
برای رفع این تعارض‌ها به‌صورت مقرون‌به‌صرفه، می‌توان زیرساخت را تقسیم‌بندی کرد و سرویس را در چندین سطح مستقل ارائه داد. در مثال Bigtable:
- **Low-latency clusters**: برای سرویس‌هایی که به **low latency** و **high reliability** نیاز دارند، طراحی می‌شوند. این clusterها با **slack capacity** زیاد (برای کاهش contention و افزایش **redundancy**) و **client isolation** قوی‌تر، **queue length** کوتاه را تضمین می‌کنند.
- **Throughput clusters**: برای بهینه‌سازی **throughput**، با **redundancy** کمتر و اجرای "داغ" (hot) طراحی می‌شوند. این clusterها می‌توانند با هزینه‌ای به‌مراتب کمتر (10–50% هزینه low-latency clusters) نیازها را برآورده کنند. با مقیاس عظیم Bigtable، این صرفه‌جویی هزینه بسیار قابل‌توجه است.

استراتژی کلیدی برای زیرساخت، ارائه سرویس‌ها با **سطوح سرویس مشخص** است تا **client**ها بتوانند تعادل مناسب بین ریسک و هزینه را انتخاب کنند. مثلاً، Google+ می‌تواند داده‌های حیاتی (مثل حریم خصوصی کاربران) را در یک datastore با **high availability** و **global consistency** (مثل Spanner) ذخیره کند، اما داده‌های غیرحیاتی (مثل داده‌های اختیاری برای بهبود تجربه کاربری) را در یک datastore ارزان‌تر، با **reliability** کمتر و **eventual consistency** (مثل Bigtable) قرار دهد.

نکته: می‌توان چندین سطح سرویس را با استفاده از **hardware** و **software** یکسان ارائه کرد. تفاوت در **service guarantees** از طریق تنظیم **quantities of resources**، **degree of redundancy**، **geographical provisioning**، و پیکربندی نرم‌افزار زیرساختی ایجاد می‌شود.

### مثال: زیرساخت Frontend
برای نشان دادن اینکه این اصول فقط به ذخیره‌سازی محدود نمی‌شوند، به **frontend infrastructure** گوگل نگاه می‌کنیم. این زیرساخت شامل سیستم‌های **reverse proxy** و **load balancing** نزدیک به لبه شبکه است که نقطه اتصال کاربران (مثل خاتمه TCP از مرورگر) را فراهم می‌کنند. به دلیل نقش حیاتی، این سیستم‌ها برای **extremely high reliability** مهندسی شده‌اند. برخلاف سرویس‌های **consumer** که می‌توانند خطاهای backend را پنهان کنند، اگر درخواستی به **frontend server** نرسد، کاملاً از دست می‌رود.

در ادامه، استفاده از **risk tolerance** برای مدیریت **unreliability** با **error budgets** بررسی می‌شود.